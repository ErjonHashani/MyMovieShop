<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/MyMovieShop/src/output.css" rel="stylesheet">

    <title>Movie</title>
</head>

<body class="min-h-screen flex flex-col">


    <!-- HEADER -->
    <header id="header" class="invisible-until-loaded bg-transparent py-4 px-16 top-0 z-20"></header>

    <!-- SPECIFIC MOVIE -->
    <main class="flex-grow invisible-until-loaded">
        <section class="py-20 min-h-[70vh] container mx-auto px-16">
            <div id="movie"></div>
        </section>
    </main>

    <!-- Login request -->
    <section id="login-request" class="invisible-until-loaded"></section>


    <!-- FOOTER -->
    <footer id="footer" class="invisible-until-loaded bg-gray-800/10 ">
        <div class="container mx-auto py-5">
            <p class="text-center text-gray-300 text-sm sm:text-base">&copy; 2025 MyMovieShop. All rights reserved. Data provided by <a class="text-orange-300 hover:text-orange-600 duration-100" href="https://www.themoviedb.org/" target="_blank" rel="noopener noreferrer">TMDB</a>.</p>
        </div>
    </footer>


    <!-- <script src="./api/api.js"></script> -->
    <script type="module">
        // Imported Modules
        import { movie } from '/MyMovieShop/api/api.js';
        import Header from '/MyMovieShop/components/header.js';
        import Footer from '/MyMovieShop/components/footer.js';

        //DOM Containers
        const header_container = document.querySelector('#header');
        const movie_container = document.querySelector('#movie');

        // Get Movie ID from URL
        const url = window.location.href.split('?')[1];
        // console.log(url[1]);
        const params = new URLSearchParams(url)
        const id = params.get('id');

        
        Promise.all([
        Header(header_container),
        // Render Movie Data
        movie(id).then(movie => {

                const defaultPoster = 'https://static.vecteezy.com/system/resources/thumbnails/022/059/000/small_2x/no-image-available-icon-vector.jpg';

                const imageUrl = movie.poster_path
                    ? `https://image.tmdb.org/t/p/original${movie.poster_path}` : defaultPoster;

                const backdropUrl = `https://image.tmdb.org/t/p/w1280${movie.backdrop_path}`;

                const year = movie.release_date.split('-')[0];

                movie_container.innerHTML = `
                    <div class="fixed inset-0 -z-50">
                        <img src="${backdropUrl}" 
                        class="w-full h-full object-cover" 
                        alt="Movie background">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/90 to-black/60"></div>
                    </div>
                    <section class="flex flex-col lg:flex-row gap-14 text-white">
                        <div class="w-full max-w-[300px] self-center">
                            <img class="w-full h-auto rounded-lg border-3 border-gray-700 hover:border-red-700 duration-300 object-cover aspect-[2/3]" 
                                src="${imageUrl}" 
                                alt="${movie.original_title}">    
                        </div>
                        <div class="flex flex-col gap-4">
                            <h1 class="text-4xl mb-5 font-bold text-gray-100">${movie.original_title} <sup class="text-base font-normal">(${year})</sup></h1>
                            <div class="flex gap-3 items-center">
                                <div class="min-w-[3rem]">
                                    <span id="ratingCircle" class="inline-grid place-items-center w-12 h-12 border-2 rounded-full aspect-square text-center leading-none">${Math.floor(movie.vote_average * 10) / 10}</span>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    ${movie.genres.map(genre => `<span class="py-1 px-3 bg-gray-600 text-white rounded-2xl">${genre.name}</span>`).join(' ')}
                                </div>
                                <div class="py-1 px-3 bg-gray-600 text-white rounded-2xl">${formatRuntime(movie.runtime)}</div>
                            </div>
                            <div class="pt-5">
                                <p class="italic text-lg font-light">"${movie.tagline || "No tagline available"}"</p>    
                            </div>
                            <div>
                                <h3 class="text-2xl">Overview</h3>
                                <p class="font-thin xl:pr-60 text-gray-100">${movie.overview}</p>  
                            </div>
                            <div class="grid sm:grid-cols-3 gap-y-5 my-5">
                                <div class="flex flex-col gap-2"><h3 class="font-bold text-lg text-red-700 text-shadow-sm">Original Title</h3><p>${movie.original_title}</p></div>
                                <div class="flex flex-col gap-2"><h3 class="font-bold text-lg text-red-700 text-shadow-sm">Release Date</h3><p>${formatReleaseDate(movie.release_date)}</p></div> 
                                <div class="flex flex-col gap-2">
                                    <h3 class="font-bold text-lg text-red-700 text-shadow-sm ml-2">Price</h3>
                                    <div class="bg-yellow-600/20 rounded-full w-14 h-14 flex items-center justify-center">
                                        <p class="text-yellow-500 font-semibold self-center" id="price">${(movie.vote_average * 2).toFixed(2)}</p>
                                        <span class="text-yellow-400">&euro;</span>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-2 pr-20"><h3 class="font-bold text-lg text-red-700 text-shadow-sm">Production</h3><p>${movie.production_companies.map(company => company.name).join(', ') || "No data"}</p></div> 
                                <div class="flex flex-col gap-2"><h3 class="font-bold text-lg text-red-700 text-shadow-sm">Language</h3><p>${movie.spoken_languages.map(language => language.english_name).join(', ')}</p></div>
                            </div>
                            <div class="flex flex-col sm:flex-row items-center gap-2">
                                <button class="py-3 px-5 flex gap-2 justify-center items-center cursor-pointer bg-red-700 text-white font-semibold rounded-lg hover:bg-red-500 duration-150">
                                    <svg class="w-4 h-4" fill="white" xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 512 512"><path d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM188.3 147.1c-7.6 4.2-12.3 12.3-12.3 20.9l0 176c0 8.7 4.7 16.7 12.3 20.9s16.8 4.1 24.3-.5l144-88c7.1-4.4 11.5-12.1 11.5-20.5s-4.4-16.1-11.5-20.5l-144-88c-7.4-4.5-16.7-4.7-24.3-.5z"/></svg> 
                                    Watch Trailer
                                </button>
                                
                                <!-- ADD TO CART FORM -->
                                <form id="addCardForm" action="#" class="flex flex-col sm:flex-row items-center gap-2">
                                    <button id="addCart" class="flex items-center gap-2 bg-gray-700 text-white font-semibold py-3 px-5 hover:bg-gray-600 duration-150 rounded-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.3 2.3c-.4.4-.7 1-.7 1.7V20a2 2 0 002 2h14"/>
                                        </svg> 
                                        Add to cart
                                    </button>
                                    <div class="bg-gray-700 rounded-lg border-1 border-gray-300">
                                        <button id="minusButton" class="w-7 bg-gray-300 py-3 text-gray-800 cursor-pointer rounded-tl-lg rounded-bl-lg hover:bg-gray-400">-</button>
                                        <input class="w-20 bg-gray-700 py-3 pl-8" type="number" min="1" max="10" value="1">
                                        <button id="plusButton" class="w-7 bg-gray-300 py-3 text-gray-800 cursor-pointer rounded-tr-lg rounded-br-lg hover:bg-gray-400"">+</button> 
                                    </div>
                                </form>
                                
                            </div>
                        </div>
                    </section>
                    <section class="mt-32">
                        <h2 class="border-b-1 border-gray-600 text-3xl font-semibold pb-6 text-gray-100">Movie Details</h2>
                        <div class="pt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                            <div class="bg-gray-700/50 p-5 rounded-lg">
                                <h3 class="font-bold text-red-500 text-xl pb-5">Production Info</h3>
                                <div class="flex flex-col gap-2">

                                    <div class="font-semibold flex items-center gap-2">
                                        <div class="py-2 px-2 bg-yellow-600/20 rounded-full text-yellow-500 mr-2">
                                            <svg class="w-5 h-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M512 80c0 18-14.3 34.6-38.4 48c-29.1 16.1-72.5 27.5-122.3 30.9c-3.7-1.8-7.4-3.5-11.3-5C300.6 137.4 248.2 128 192 128c-8.3 0-16.4 .2-24.5 .6l-1.1-.6C142.3 114.6 128 98 128 80c0-44.2 86-80 192-80S512 35.8 512 80zM160.7 161.1c10.2-.7 20.7-1.1 31.3-1.1c62.2 0 117.4 12.3 152.5 31.4C369.3 204.9 384 221.7 384 240c0 4-.7 7.9-2.1 11.7c-4.6 13.2-17 25.3-35 35.5c0 0 0 0 0 0c-.1 .1-.3 .1-.4 .2c0 0 0 0 0 0s0 0 0 0c-.3 .2-.6 .3-.9 .5c-35 19.4-90.8 32-153.6 32c-59.6 0-112.9-11.3-148.2-29.1c-1.9-.9-3.7-1.9-5.5-2.9C14.3 274.6 0 258 0 240c0-34.8 53.4-64.5 128-75.4c10.5-1.5 21.4-2.7 32.7-3.5zM416 240c0-21.9-10.6-39.9-24.1-53.4c28.3-4.4 54.2-11.4 76.2-20.5c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 19.3-16.5 37.1-43.8 50.9c-14.6 7.4-32.4 13.7-52.4 18.5c.1-1.8 .2-3.5 .2-5.3zm-32 96c0 18-14.3 34.6-38.4 48c-1.8 1-3.6 1.9-5.5 2.9C304.9 404.7 251.6 416 192 416c-62.8 0-118.6-12.6-153.6-32C14.3 370.6 0 354 0 336l0-35.4c12.5 10.3 27.6 18.7 43.9 25.5C83.4 342.6 135.8 352 192 352s108.6-9.4 148.1-25.9c7.8-3.2 15.3-6.9 22.4-10.9c6.1-3.4 11.8-7.2 17.2-11.2c1.5-1.1 2.9-2.3 4.3-3.4l0 3.4 0 5.7 0 26.3zm32 0l0-32 0-25.9c19-4.2 36.5-9.5 52.1-16c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 10.5-5 21-14.9 30.9c-16.3 16.3-45 29.7-81.3 38.4c.1-1.7 .2-3.5 .2-5.3zM192 448c56.2 0 108.6-9.4 148.1-25.9c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 44.2-86 80-192 80S0 476.2 0 432l0-35.4c12.5 10.3 27.6 18.7 43.9 25.5C83.4 438.6 135.8 448 192 448z"/></svg>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-yellow-300">Budget</span>
                                            <span class="text-sm text-white ">${movie.budget > 0 ? '$' + movie.budget.toLocaleString('en-US') : 'Not disclosed'}</span>
                                        </div>

                                    </div>

                                    <div class="font-semibold flex items-center gap-2">
                                        <div class="py-2 px-2 bg-blue-600/20 rounded-full text-blue-500 mr-2">
                                            <svg class="w-5 h-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 96L192 96 144.6 24.9C137.5 14.2 145.1 0 157.9 0L354.1 0c12.8 0 20.4 14.2 13.3 24.9L320 96zM192 128l128 0c3.8 2.5 8.1 5.3 13 8.4C389.7 172.7 512 250.9 512 416c0 53-43 96-96 96L96 512c-53 0-96-43-96-96C0 250.9 122.3 172.7 179 136.4c0 0 0 0 0 0s0 0 0 0c4.8-3.1 9.2-5.9 13-8.4zm84 88c0-11-9-20-20-20s-20 9-20 20l0 14c-7.6 1.7-15.2 4.4-22.2 8.5c-13.9 8.3-25.9 22.8-25.8 43.9c.1 20.3 12 33.1 24.7 40.7c11 6.6 24.7 10.8 35.6 14l1.7 .5c12.6 3.8 21.8 6.8 28 10.7c5.1 3.2 5.8 5.4 5.9 8.2c.1 5-1.8 8-5.9 10.5c-5 3.1-12.9 5-21.4 4.7c-11.1-.4-21.5-3.9-35.1-8.5c-2.3-.8-4.7-1.6-7.2-2.4c-10.5-3.5-21.8 2.2-25.3 12.6s2.2 21.8 12.6 25.3c1.9 .6 4 1.3 6.1 2.1c0 0 0 0 0 0s0 0 0 0c8.3 2.9 17.9 6.2 28.2 8.4l0 14.6c0 11 9 20 20 20s20-9 20-20l0-13.8c8-1.7 16-4.5 23.2-9c14.3-8.9 25.1-24.1 24.8-45c-.3-20.3-11.7-33.4-24.6-41.6c-11.5-7.2-25.9-11.6-37.1-15c0 0 0 0 0 0l-.7-.2c-12.8-3.9-21.9-6.7-28.3-10.5c-5.2-3.1-5.3-4.9-5.3-6.7c0-3.7 1.4-6.5 6.2-9.3c5.4-3.2 13.6-5.1 21.5-5c9.6 .1 20.2 2.2 31.2 5.2c10.7 2.8 21.6-3.5 24.5-14.2s-3.5-21.6-14.2-24.5c-6.5-1.7-13.7-3.4-21.1-4.7l0-13.9z"/></svg>
                                        </div> 
                                        <div class="flex flex-col">
                                            <span class="text-blue-300">Revenue</span> 
                                            <span class="text-sm text-white">${movie.revenue > 0 ? '$' + movie.revenue.toLocaleString('en-US') : 'Not   disclosed'}</span>
                                        </div>
                                    </div>

                                    <div class="font-semibold flex items-center gap-2">
                                        <div class="py-2 px-2 bg-purple-600/30 rounded-full text-purple-500 mr-2">
                                            <svg class="w-5 h-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32L0 64 0 368 0 480c0 17.7 14.3 32 32 32s32-14.3 32-32l0-128 64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30l0-247.7c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48l0-16z"/></svg>    
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-purple-300">Country</span> 
                                            <span class="text-sm text-white">${movie.production_countries.map((country) => country.name).join(', ') || "No data"}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-700/50 p-5 rounded-lg">
                                <h3 class="font-bold text-red-500 text-xl pb-5">Status</h3>
                                <div class="font-semibold flex items-center gap-2">
                                    <div class="py-2 px-2 bg-gray-500/40 rounded-full text-black mr-2">
                                        <svg class="w-5 h-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M576 0c17.7 0 32 14.3 32 32l0 448c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-448c0-17.7 14.3-32 32-32zM448 96c17.7 0 32 14.3 32 32l0 352c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-352c0-17.7 14.3-32 32-32zM352 224l0 256c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32s32 14.3 32 32zM192 288c17.7 0 32 14.3 32 32l0 160c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-160c0-17.7 14.3-32 32-32zM96 416l0 64c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32s32 14.3 32 32z"/></svg>
                                    </div>
                                    <span class="text-base font-semibold ${movie.status === 'Released' ? 'text-green-500' : movie.status === 'Upcoming' ? 'text-gray-500' : 'text-gray-200'}">${movie.status}</span>
                                </div>
                            </div>

                            <div class="bg-gray-700/50 p-5 rounded-lg">
                                <h3 class="font-bold text-red-500 text-lg pb-3">Reviews</h3>
                                <div class="flex flex-col gap-2">
                                    <p>${createStarRating(movie.vote_average, movie.vote_count)}</p>
                                </div>
                            </div>
                        </div>
                    </section>
                `;

                const ratingCircle = document.getElementById('ratingCircle');
                const rating = movie.vote_average;

                // Rating circle color based on vote_average
                ratingCircle.classList.remove(
                    'border-green-500', 'text-green-500',
                    'border-yellow-500', 'text-yellow-500',
                    'border-red-500', 'text-red-500'
                );

                // Applied colors logic
                if (rating >= 7) {
                    ratingCircle.classList.add('border-green-500', 'text-green-500');
                } else if (rating >= 5) {
                    ratingCircle.classList.add('border-yellow-500', 'text-yellow-500');
                } else {
                    ratingCircle.classList.add('border-red-500', 'text-red-500');
                }

                // Hour and Minutes display function
                function formatRuntime(minutes) {
                    const hours = Math.floor(minutes / 60);
                    const mins = minutes % 60;
                    return `${hours}h ${mins.toString().padStart(2, '0')}min`;
                }

                //Release date format
                function formatReleaseDate(apiDate) {
                    if (!apiDate) return 'Date not available';

                    const [year, month, day] = apiDate.split('-');

                    const monthNames = [
                        'January', 'February', 'March', 'April',
                        'May', 'June', 'July', 'August',
                        'September', 'October', 'November', 'December'
                    ];

                    // Remove leading zero from day (e.g., "05" â†’ "5")
                    const formattedDay = parseInt(day, 10).toString();

                    return `${monthNames[parseInt(month) - 1]} ${formattedDay}, ${year}`;
                }


                // Generating stars function
                function createStarRating(voteAverage, voteCount) {
                    // Convert 0-10 scale to 0-5 stars
                    const stars = voteAverage / 2;
                    const fullStars = Math.floor(stars);
                    const hasHalfStar = stars % 1 >= 0.5;
                    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

                    // SVG stars
                    const fullStar = `<svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/></svg>`;

                    const halfStar = `
                    <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <path fill="currentColor" d="M288 0c-11.4 0-22.8 5.9-28.7 17.8L194 150.2 47.9 171.4c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.1 23 46 46.4 33.7L288 439.6V0z"/>
                    <path fill="currentColor" opacity="0.3" d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.7 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z"/></svg>`;

                    const emptyStar = `<svg class="w-5 h-5 text-gray-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.7 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z"/></svg>`;

                    // Generating stars HTML
                    let starsHTML = '';
                    for (let i = 0; i < fullStars; i++) starsHTML += fullStar;
                    if (hasHalfStar) starsHTML += halfStar;
                    for (let i = 0; i < emptyStars; i++) starsHTML += emptyStar;


                    return `
                        <div class="flex items-center">
                        <div class="flex mr-2">${starsHTML}</div>
                        <span class="text-sm text-gray-500">${Math.floor(voteAverage * 10) / 10}/10 (${voteCount} reviews)</span>
                        </div>
                    `;
                }

                // Getting price
                const price = parseFloat(document.querySelector('#price')?.textContent || 0);
                const quantityInput = document.querySelector('#addCardForm input[type="number"]');
                const addCardForm = document.querySelector('#addCardForm');

                // Minus button listener
                document.getElementById('minusButton').addEventListener('click', (e) => {
                    e.preventDefault();
                    if (quantityInput.value > 1) quantityInput.value--;
                });
                // Plus button listener
                document.getElementById('plusButton').addEventListener('click', (e) => {
                    e.preventDefault();
                    if (quantityInput.value < 10) quantityInput.value++;
                });

                // Form listener
                addCardForm.addEventListener('submit', function (event) {
                    event.preventDefault();

                    const quantity = parseInt(quantityInput.value);
                    const totalPrice = (price * quantity).toFixed(2);

                    // Store raw values
                    localStorage.setItem('lastAdded_movieId', movie.id);
                    localStorage.setItem('lastAdded_title', movie.title);
                    localStorage.setItem('lastAdded_quantity', quantity);
                    localStorage.setItem('lastAdded_totalPrice', totalPrice);

                    // Optional: Track all items as a delimited string
                    const existingItems = localStorage.getItem('cartItems') || '';
                    localStorage.setItem('cartItems', `${existingItems}${movie.id}:${quantity}:${totalPrice},`);

                    // Notification element
                    const notification = document.createElement('div');
                    // Parent div (notification) added classes
                    notification.className = `fixed bottom-4 right-4 py-3 px-5 bg-green-600 text-gray-100 flex items-center gap-2 rounded-lg opacity-0 translate-y-4 transition-all duration-300 ease-out`;

                    // Short movie title (15 characters max)
                    const shortTitle = movie.original_title.length > 15 ? `${movie.original_title.substring(0,15)}...` : movie.original_title;

                    // Adding children via innerHTML
                    notification.innerHTML = `
                    <svg class="w-4 h-4 shrink-0" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/></svg>
                    <span>Added ${quantity} x "${shortTitle}" (&euro;${totalPrice}) to cart</span>
                    <span class="bg-white p-1 rounded-full animate-ping"></span>
                    `;

                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.classList.remove('opacity-0', 'translate-y-4');
                        notification.classList.add('opacity-100', 'translate-y-0');
                    }, 10);

                    setTimeout(() => {
                        notification.classList.remove('opacity-100', 'translate-y-0');
                        notification.classList.add('opacity-0', 'translate-y-4');
    
                        setTimeout(() => notification.remove(), 200);
                    }, 3000);

                    console.log('Saved:', {
                        id: movie.id,
                        quantity,
                        totalPrice
                    });

                })

            })
        ]).then(() => {
            document.querySelectorAll('.invisible-until-loaded')
            .forEach(el => el.classList.replace('invisible-until-loaded', 'visible-when-loaded'));
        }).catch(error => {
        console.error("Loading failed:", error);
        // Show error message to user
        movie_container.innerHTML = `
            <div class="text-red-500 p-8 text-center">
            Failed to load movie data. Please try again.
            </div>
        `;
        // Still show header/footer
        document.querySelectorAll('.invisible-until-loaded')
            .forEach(el => el.classList.replace('invisible-until-loaded', 'visible-when-loaded'));
        });

    </script>

</body>

</html>